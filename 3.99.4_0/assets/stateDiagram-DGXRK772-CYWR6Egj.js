import{s as W,S as N,a as P}from"./chunk-AEK57VVT-CJNq13A6.js";import{_ as f,d as t,j as T,l as S,k as C,e as z,Q as U,R as D,u as F}from"./MermaidPreview-CX3oxt-0.js";import{G as I}from"./graph-8bHhX37e.js";import{l as O}from"./layout-BzFs7pdY.js";import"./chunk-RZ5BOZE2-Be04xuYu.js";import"./premium-CHh0JHCP.js";import"./user-config-B2p-VbRf.js";import"./merge-CpUPYoWF.js";import"./reduce-BLoHwvCR.js";import"./_baseUniq-Cpwc2P36.js";import"./map-ByswxN6x.js";import"./min-DsEQ3uiE.js";import"./_baseOrderBy-CdhNP8Ip.js";(function(){try{var e=typeof window<"u"?window:typeof global<"u"?global:typeof globalThis<"u"?globalThis:typeof self<"u"?self:{},i=new e.Error().stack;i&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[i]="036f6d73-d0c4-4114-b6fd-a37ed1f72cd0",e._sentryDebugIdIdentifier="sentry-dbid-036f6d73-d0c4-4114-b6fd-a37ed1f72cd0")}catch{}})();var L={},J=f((e,i)=>{L[e]=i},"set"),X=f(e=>L[e],"get"),A=f(()=>Object.keys(L),"keys"),Y=f(()=>A().length,"size"),$={get:X,set:J,keys:A,size:Y},j=f(e=>e.append("circle").attr("class","start-state").attr("r",t().state.sizeUnit).attr("cx",t().state.padding+t().state.sizeUnit).attr("cy",t().state.padding+t().state.sizeUnit),"drawStartState"),q=f(e=>e.append("line").style("stroke","grey").style("stroke-dasharray","3").attr("x1",t().state.textHeight).attr("class","divider").attr("x2",t().state.textHeight*2).attr("y1",0).attr("y2",0),"drawDivider"),Q=f((e,i)=>{const n=e.append("text").attr("x",2*t().state.padding).attr("y",t().state.textHeight+2*t().state.padding).attr("font-size",t().state.fontSize).attr("class","state-title").text(i.id),o=n.node().getBBox();return e.insert("rect",":first-child").attr("x",t().state.padding).attr("y",t().state.padding).attr("width",o.width+2*t().state.padding).attr("height",o.height+2*t().state.padding).attr("rx",t().state.radius),n},"drawSimpleState"),Z=f((e,i)=>{const n=f(function(l,b,m){const k=l.append("tspan").attr("x",2*t().state.padding).text(b);m||k.attr("dy",t().state.textHeight)},"addTspan"),d=e.append("text").attr("x",2*t().state.padding).attr("y",t().state.textHeight+1.3*t().state.padding).attr("font-size",t().state.fontSize).attr("class","state-title").text(i.descriptions[0]).node().getBBox(),g=d.height,x=e.append("text").attr("x",t().state.padding).attr("y",g+t().state.padding*.4+t().state.dividerMargin+t().state.textHeight).attr("class","state-description");let a=!0,s=!0;i.descriptions.forEach(function(l){a||(n(x,l,s),s=!1),a=!1});const w=e.append("line").attr("x1",t().state.padding).attr("y1",t().state.padding+g+t().state.dividerMargin/2).attr("y2",t().state.padding+g+t().state.dividerMargin/2).attr("class","descr-divider"),p=x.node().getBBox(),c=Math.max(p.width,d.width);return w.attr("x2",c+3*t().state.padding),e.insert("rect",":first-child").attr("x",t().state.padding).attr("y",t().state.padding).attr("width",c+2*t().state.padding).attr("height",p.height+g+2*t().state.padding).attr("rx",t().state.radius),e},"drawDescrState"),K=f((e,i,n)=>{const o=t().state.padding,d=2*t().state.padding,g=e.node().getBBox(),x=g.width,a=g.x,s=e.append("text").attr("x",0).attr("y",t().state.titleShift).attr("font-size",t().state.fontSize).attr("class","state-title").text(i.id),p=s.node().getBBox().width+d;let c=Math.max(p,x);c===x&&(c=c+d);let l;const b=e.node().getBBox();i.doc,l=a-o,p>x&&(l=(x-c)/2+o),Math.abs(a-b.x)<o&&p>x&&(l=a-(p-x)/2);const m=1-t().state.textHeight;return e.insert("rect",":first-child").attr("x",l).attr("y",m).attr("class",n?"alt-composit":"composit").attr("width",c).attr("height",b.height+t().state.textHeight+t().state.titleShift+1).attr("rx","0"),s.attr("x",l+o),p<=x&&s.attr("x",a+(c-d)/2-p/2+o),e.insert("rect",":first-child").attr("x",l).attr("y",t().state.titleShift-t().state.textHeight-t().state.padding).attr("width",c).attr("height",t().state.textHeight*3).attr("rx",t().state.radius),e.insert("rect",":first-child").attr("x",l).attr("y",t().state.titleShift-t().state.textHeight-t().state.padding).attr("width",c).attr("height",b.height+3+2*t().state.textHeight).attr("rx",t().state.radius),e},"addTitleAndBox"),V=f(e=>(e.append("circle").attr("class","end-state-outer").attr("r",t().state.sizeUnit+t().state.miniPadding).attr("cx",t().state.padding+t().state.sizeUnit+t().state.miniPadding).attr("cy",t().state.padding+t().state.sizeUnit+t().state.miniPadding),e.append("circle").attr("class","end-state-inner").attr("r",t().state.sizeUnit).attr("cx",t().state.padding+t().state.sizeUnit+2).attr("cy",t().state.padding+t().state.sizeUnit+2)),"drawEndState"),tt=f((e,i)=>{let n=t().state.forkWidth,o=t().state.forkHeight;if(i.parentId){let d=n;n=o,o=d}return e.append("rect").style("stroke","black").style("fill","black").attr("width",n).attr("height",o).attr("x",t().state.padding).attr("y",t().state.padding)},"drawForkJoinState"),et=f((e,i,n,o)=>{let d=0;const g=o.append("text");g.style("text-anchor","start"),g.attr("class","noteText");let x=e.replace(/\r\n/g,"<br/>");x=x.replace(/\n/g,"<br/>");const a=x.split(z.lineBreakRegex);let s=1.25*t().state.noteMargin;for(const w of a){const p=w.trim();if(p.length>0){const c=g.append("tspan");if(c.text(p),s===0){const l=c.node().getBBox();s+=l.height}d+=s,c.attr("x",i+t().state.noteMargin),c.attr("y",n+d+1.25*t().state.noteMargin)}}return{textWidth:g.node().getBBox().width,textHeight:d}},"_drawLongText"),at=f((e,i)=>{i.attr("class","state-note");const n=i.append("rect").attr("x",0).attr("y",t().state.padding),o=i.append("g"),{textWidth:d,textHeight:g}=et(e,0,0,o);return n.attr("height",g+2*t().state.noteMargin),n.attr("width",d+t().state.noteMargin*2),n},"drawNote"),_=f(function(e,i){const n=i.id,o={id:n,label:i.id,width:0,height:0},d=e.append("g").attr("id",n).attr("class","stateGroup");i.type==="start"&&j(d),i.type==="end"&&V(d),(i.type==="fork"||i.type==="join")&&tt(d,i),i.type==="note"&&at(i.note.text,d),i.type==="divider"&&q(d),i.type==="default"&&i.descriptions.length===0&&Q(d,i),i.type==="default"&&i.descriptions.length>0&&Z(d,i);const g=d.node().getBBox();return o.width=g.width+2*t().state.padding,o.height=g.height+2*t().state.padding,$.set(n,o),o},"drawState"),R=0,it=f(function(e,i,n){const o=f(function(s){switch(s){case N.relationType.AGGREGATION:return"aggregation";case N.relationType.EXTENSION:return"extension";case N.relationType.COMPOSITION:return"composition";case N.relationType.DEPENDENCY:return"dependency"}},"getRelationType");i.points=i.points.filter(s=>!Number.isNaN(s.y));const d=i.points,g=U().x(function(s){return s.x}).y(function(s){return s.y}).curve(D),x=e.append("path").attr("d",g(d)).attr("id","edge"+R).attr("class","transition");let a="";if(t().state.arrowMarkerAbsolute&&(a=window.location.protocol+"//"+window.location.host+window.location.pathname+window.location.search,a=a.replace(/\(/g,"\\("),a=a.replace(/\)/g,"\\)")),x.attr("marker-end","url("+a+"#"+o(N.relationType.DEPENDENCY)+"End)"),n.title!==void 0){const s=e.append("g").attr("class","stateLabel"),{x:w,y:p}=F.calcLabelPosition(i.points),c=z.getRows(n.title);let l=0;const b=[];let m=0,k=0;for(let u=0;u<=c.length;u++){const h=s.append("text").attr("text-anchor","middle").text(c[u]).attr("x",w).attr("y",p+l),y=h.node().getBBox();m=Math.max(m,y.width),k=Math.min(k,y.x),S.info(y.x,w,p+l),l===0&&(l=h.node().getBBox().height,S.info("Title height",l,p)),b.push(h)}let E=l*c.length;if(c.length>1){const u=(c.length-1)*l*.5;b.forEach((h,y)=>h.attr("y",p+y*l-u)),E=l*c.length}const r=s.node().getBBox();s.insert("rect",":first-child").attr("class","box").attr("x",w-m/2-t().state.padding/2).attr("y",p-E/2-t().state.padding/2-3.5).attr("width",m+t().state.padding).attr("height",E+t().state.padding),S.info(r)}R++},"drawEdge"),B,H={},rt=f(function(){},"setConf"),nt=f(function(e){e.append("defs").append("marker").attr("id","dependencyEnd").attr("refX",19).attr("refY",7).attr("markerWidth",20).attr("markerHeight",28).attr("orient","auto").append("path").attr("d","M 19,7 L9,13 L14,7 L9,1 Z")},"insertMarkers"),dt=f(function(e,i,n,o){B=t().state;const d=t().securityLevel;let g;d==="sandbox"&&(g=T("#i"+i));const x=d==="sandbox"?T(g.nodes()[0].contentDocument.body):T("body"),a=d==="sandbox"?g.nodes()[0].contentDocument:document;S.debug("Rendering diagram "+e);const s=x.select(`[id='${i}']`);nt(s);const w=o.db.getRootDoc();G(w,s,void 0,!1,x,a,o);const p=B.padding,c=s.node().getBBox(),l=c.width+p*2,b=c.height+p*2,m=l*1.75;C(s,b,m,B.useMaxWidth),s.attr("viewBox",`${c.x-B.padding}  ${c.y-B.padding} `+l+" "+b)},"draw"),st=f(e=>e?e.length*B.fontSizeFactor:1,"getLabelWidth"),G=f((e,i,n,o,d,g,x)=>{const a=new I({compound:!0,multigraph:!0});let s,w=!0;for(s=0;s<e.length;s++)if(e[s].stmt==="relation"){w=!1;break}n?a.setGraph({rankdir:"LR",multigraph:!0,compound:!0,ranker:"tight-tree",ranksep:w?1:B.edgeLengthFactor,nodeSep:w?1:50,isMultiGraph:!0}):a.setGraph({rankdir:"TB",multigraph:!0,compound:!0,ranksep:w?1:B.edgeLengthFactor,nodeSep:w?1:50,ranker:"tight-tree",isMultiGraph:!0}),a.setDefaultEdgeLabel(function(){return{}});const p=x.db.getStates(),c=x.db.getRelations(),l=Object.keys(p);for(const r of l){const u=p[r];n&&(u.parentId=n);let h;if(u.doc){let y=i.append("g").attr("id",u.id).attr("class","stateGroup");h=G(u.doc,y,u.id,!o,d,g,x);{y=K(y,u,o);let v=y.node().getBBox();h.width=v.width,h.height=v.height+B.padding/2,H[u.id]={y:B.compositTitleSize}}}else h=_(i,u,a);if(u.note){const y={descriptions:[],id:u.id+"-note",note:u.note,type:"note"},v=_(i,y,a);u.note.position==="left of"?(a.setNode(h.id+"-note",v),a.setNode(h.id,h)):(a.setNode(h.id,h),a.setNode(h.id+"-note",v)),a.setParent(h.id,h.id+"-group"),a.setParent(h.id+"-note",h.id+"-group")}else a.setNode(h.id,h)}S.debug("Count=",a.nodeCount(),a);let b=0;c.forEach(function(r){b++,S.debug("Setting edge",r),a.setEdge(r.id1,r.id2,{relation:r,width:st(r.title),height:B.labelHeight*z.getRows(r.title).length,labelpos:"c"},"id"+b)}),O(a),S.debug("Graph after layout",a.nodes());const m=i.node();a.nodes().forEach(function(r){r!==void 0&&a.node(r)!==void 0?(S.warn("Node "+r+": "+JSON.stringify(a.node(r))),d.select("#"+m.id+" #"+r).attr("transform","translate("+(a.node(r).x-a.node(r).width/2)+","+(a.node(r).y+(H[r]?H[r].y:0)-a.node(r).height/2)+" )"),d.select("#"+m.id+" #"+r).attr("data-x-shift",a.node(r).x-a.node(r).width/2),g.querySelectorAll("#"+m.id+" #"+r+" .divider").forEach(h=>{const y=h.parentElement;let v=0,M=0;y&&(y.parentElement&&(v=y.parentElement.getBBox().width),M=parseInt(y.getAttribute("data-x-shift"),10),Number.isNaN(M)&&(M=0)),h.setAttribute("x1",0-M+8),h.setAttribute("x2",v-M-8)})):S.debug("No Node "+r+": "+JSON.stringify(a.node(r)))});let k=m.getBBox();a.edges().forEach(function(r){r!==void 0&&a.edge(r)!==void 0&&(S.debug("Edge "+r.v+" -> "+r.w+": "+JSON.stringify(a.edge(r))),it(i,a.edge(r),a.edge(r).relation))}),k=m.getBBox();const E={id:n||"root",label:n||"root",width:0,height:0};return E.width=k.width+2*B.padding,E.height=k.height+2*B.padding,S.debug("Doc rendered",E,a),E},"renderDoc"),ot={setConf:rt,draw:dt},St={parser:W,get db(){return new N(1)},renderer:ot,styles:P,init:f(e=>{e.state||(e.state={}),e.state.arrowMarkerAbsolute=e.arrowMarkerAbsolute},"init")};export{St as diagram};
//# sourceMappingURL=stateDiagram-DGXRK772-CYWR6Egj.js.map
